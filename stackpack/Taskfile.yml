version: '3'

dotenv:
  - ../.env

vars:
  OLLAMA_IMG: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQ2IiBoZWlnaHQ9Ijg1NCIgdmlld0JveD0iMCAwIDY0NiA4NTQiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGQ9Ik0xNDAuNjI5IDAuMjM5OTI5QzEzMi42NiAxLjUyNzI1IDEyMy4wOTcgNS42OTU2OCAxMTYuMzU0IDEwLjg0NUM5NS45NDEgMjYuMzU0MSA4MC4xMjUzIDU5LjI3MjggNzMuNDQzNSAxMDAuMjgzQzcwLjkzMDIgMTE1Ljc5MiA2OS4yMTM4IDEzNy4zMDkgNjkuMjEzOCAxNTMuNzM4QzY5LjIxMzggMTczLjEwOSA3MS40ODE5IDE5Ny44NzQgNzQuNzMwOSAyMTQuOTc3Qzc1LjQ2NjUgMjE4Ljc3OCA3NS44MzQzIDIyMi4xNSA3NS41Mjc4IDIyMi4zOTVDNzUuMjgyNiAyMjIuNjQgNzIuMjc4OCAyMjUuMDkyIDY4LjkwNzIgMjI3Ljc4OUM1Ny4zODI3IDIzNi45ODQgNDQuMjAyOSAyNTEuMTQ1IDM1LjEzMDQgMjY0LjA4QzE3LjcyMDkgMjg4Ljc4NCA2LjQ0MTUxIDMxNi44NiAxLjcyMTMzIDM0Ny4yNjVDLTAuMTE3Njk4IDM1OS4yOCAtMC42MDgxMDYgMzgzLjU1NSAwLjg2MzExOCAzOTUuNTdDNC4xMTIwNyA0MjMuMjc4IDEyLjQ0OSA0NDYuNjk1IDI2LjczMjEgNDY4LjE1MUwzMS4zOTEgNDc1LjA3OEwzMC4wNDI0IDQ3Ny4zNDZDMjAuNDc5NCA0OTMuNDA3IDEyLjMyNjQgNTE2LjY0IDguNTI1NzUgNTM4Ljk1M0M1LjUyMiA1NTYuNjA4IDUuMTU0MTkgNTYxLjMyOCA1LjE1NDE5IDU4NC45OUM1LjE1NDE5IDYwOC44MzcgNS40NjA3IDYxMy41NTcgOC4yODA1NCA2MzAuMDQ3QzExLjY1MjEgNjQ5Ljc4NiAxOC41MTc4IDY3MC42ODkgMjYuMTgwNCA2ODQuNjA1QzI4LjY5MzggNjg5LjE0MSAzNC44MjM5IDY5OC41ODEgMzUuNTU5NSA2OTkuMDcyQzM1LjgwNDcgNjk5LjE5NCAzNS4wNjkxIDcwMS40NjIgMzMuOTA0NCA3MDQuMDk4QzI1LjA3NyA3MjMuNDA4IDE3LjUzNyA3NDkuMDkzIDE0LjQxMDYgNzcwLjczM0MxMi4yMDM4IDc4NS41NjcgMTEuODk3MyA3OTAuMzQ5IDExLjg5NzMgODA1Ljk4MUMxMS44OTczIDgyNS45MDMgMTMuMDAwNyA4MzUuNTg5IDE3LjE2OTIgODUxLjQ2NkwxNy43ODIyIDg1My43OTVINDQuMDE5SDcwLjMxNzJMNjguNjAwNyA4NTAuNTQ2QzU3Ljk5NTcgODMwLjkzIDU3LjAxNDkgNzk0LjUxNyA2Ni4xNDg3IDc1OC4xNjZDNzAuMzE3MiA3NDEuMzY5IDc1LjAzNzQgNzI5LjA0OCA4My44NjQ3IDcxMi4wNjdMODkuMTM2NiA3MDEuNzY5VjY5NS40NTVDODkuMTM2NiA2ODkuNTcgODkuMDE0IDY4OC44OTYgODcuMTEzNyA2ODUuMDM0Qzg1LjY0MjQgNjgyLjA5MSA4My42ODA4IDY3OS41NzggODAuMTg2NiA2NzYuMTQ1Qzc0LjI0MDQgNjcwLjM4MyA2OS45NDk0IDY2NC4zMTQgNjYuNTE2NSA2NTYuODM1QzUxLjQzNjUgNjI0LjEgNDguNDk0IDU3NS40ODkgNTkuMDk5MSA1MzQuMDQ5QzYzLjUxMjggNTE2Ljc2MiA3MC44MDc2IDUwMS4zNzYgNzguNDcwMiA0OTIuOTc4QzgzLjY4MDggNDg3LjIxNSA4Ni4zNzggNDgwLjc3OSA4Ni4zNzggNDc0LjA5N0M4Ni4zNzggNDY3LjE3IDgzLjkyNiA0NjEuNDY5IDc4LjQwODkgNDU1LjUyM0M2Mi41OTMyIDQzOC42MDQgNTIuODQ2NCA0MTguMDA2IDQ5LjM1MjIgMzk0LjAzOEM0NC4zODY4IDM1OS44OTMgNTMuMzk4MSAzMjIuNjgzIDczLjg3MjYgMjkzLjE5OEM5My45MTgxIDI2NC4yNjMgMTIyLjA1NSAyNDUuNjg5IDE1My41MDMgMjQwLjcyNEMxNjAuNTUyIDIzOS41NTkgMTczLjczMiAyMzkuNzQzIDE4MS4wODggMjQxLjA5MkMxODkuMTE5IDI0Mi41MDIgMTk0LjE0NSAyNDIuMDcyIDE5OS4yOTUgMjM5LjYyQzIwNS42NyAyMzYuNjE3IDIwOC44NTggMjMyLjg3NyAyMTIuNTk3IDIyNC4yOTVDMjE1LjkwNyAyMTYuNjMzIDIxOC40ODIgMjEyLjQ2NCAyMjUuNDA5IDIwMy44MjFDMjMzLjc0NiAxOTMuNDYxIDI0MS43NzYgMTg2LjQxMSAyNTQuNjQ5IDE3Ny44OUMyNjkuMzYyIDE2OC4yNjYgMjg2LjA5NyAxNjEuMjc4IDMwMi43NzEgMTU3LjkwNkMzMDguODM5IDE1Ni42OCAzMTEuNjU5IDE1Ni40OTYgMzIzIDE1Ni40OTZDMzM0LjM0MSAxNTYuNDk2IDMzNy4xNjEgMTU2LjY4IDM0My4yMjkgMTU3LjkwNkMzNjcuNjg4IDE2Mi44NzIgMzkxLjk2NCAxNzUuNSA0MTEuMzM1IDE5My4zOTlDNDE1LjUwMyAxOTcuMjYxIDQyNS40OTUgMjA5LjY0NCA0MjguNjgzIDIxNC43OTRDNDI5LjkwOSAyMTYuODE2IDQzMi4wNTUgMjIxLjEwOCA0MzMuNDAzIDIyNC4yOTVDNDM3LjE0MiAyMzIuODc3IDQ0MC4zMyAyMzYuNjE3IDQ0Ni43MDUgMjM5LjYyQzQ1MS42NzEgMjQyLjAxMSA0NTYuODgxIDI0Mi41MDIgNDY0LjYwNSAyNDEuMjE0QzQ3Ni44MDQgMjM5LjEzIDQ4Ni4xODMgMjM5LjMxNCA0OTguMTM3IDI0MS43NjZDNTM4Ljg0MSAyNDkuOTggNTc0LjI3MyAyODMuNTEyIDU4OS45NjYgMzI4LjQ0NkM2MDMuNjM2IDM2Ny44NjIgNTk5Ljc3NCA0MDkuMTE4IDU3OS40MjIgNDQwLjYyNkM1NzUuOTg5IDQ0NS45NiA1NzIuNTU2IDQ1MC4yNTEgNTY3LjU5MSA0NTUuNTIzQzU1Ni44NjMgNDY2Ljk4NiA1NTYuODYzIDQ4MS4yMDggNTY3LjUzIDQ5Mi45NzhDNTg1LjA2MiA1MTIuMTY1IDU5Ni4wMzUgNTU5LjM2NyA1OTIuNzI0IDYwMC45OUM1OTAuNTE4IDYyOC40NTMgNTgzLjQ2OCA2NTMuMDM1IDU3My43ODIgNjY2Ljk1QzU3Mi4wNjYgNjY5LjQwMiA1NjguNTExIDY3My41NyA1NjUuODEzIDY3Ni4xNDVDNTYyLjMxOSA2NzkuNTc4IDU2MC4zNTggNjgyLjA5MSA1NTguODg2IDY4NS4wMzRDNTU2Ljk4NiA2ODguODk2IDU1Ni44NjMgNjg5LjU3IDU1Ni44NjMgNjk1LjQ1NVY3MDEuNzY5TDU2Mi4xMzUgNzEyLjA2N0M1NzAuOTYzIDcyOS4wNDggNTc1LjY4MyA3NDEuMzY5IDU3OS44NTEgNzU4LjE2NkM1ODguODYzIDc5NC4wMjcgNTg4LjA2NiA4MjkuNzA0IDU3Ny43NjcgODQ5Ljk5NUM1NzYuOTA5IDg1MS43MTEgNTc2LjE3MyA4NTMuMzA1IDU3Ni4xNzMgODUzLjQ4OUM1NzYuMTczIDg1My42NzMgNTg3Ljg4MiA4NTMuNzk1IDYwMi4yMjYgODUzLjc5NUg2MjguMjE4TDYyOC44OTIgODUxLjE1OUM2MjkuMjYgODQ5Ljc1IDYyOS44NzMgODQ3LjYwNCA2MzAuMTc5IDg0Ni4zNzhDNjMwLjg1NCA4NDMuNjgxIDYzMi4yMDIgODM1LjcxMiA2MzMuMzA2IDgyOC4wNDlDNjM0LjM0OCA4MjAuMzI1IDYzNC4zNDggNzkxLjg4MSA2MzMuMzA2IDc4My4yOTlDNjI5LjM4MyA3NTIuMTU4IDYyMi44MjMgNzI3LjQ1NCA2MTIuMDk2IDcwNC4wOThDNjEwLjkzMSA3MDEuNDYyIDYxMC4xOTUgNjk5LjE5NCA2MTAuNDQgNjk5LjA3MkM2MTAuNzQ3IDY5OC44ODggNjEyLjQ2MyA2OTYuNDM2IDYxNC4zMDIgNjkzLjY3N0M2MjcuNjY2IDY3My40NDggNjM1Ljg4IDY0OC4wMDggNjQwLjA0OSA2MTQuNDE1QzY0MS4xNTIgNjA1LjE1OCA2NDEuMTUyIDU2NS4zNzQgNjQwLjA0OSA1NTYuNDg1QzYzNy4xMDYgNTMzLjU1OSA2MzMuNTUxIDUxNy45ODggNjI3LjY2NiA1MDIuMjM0QzYyNS4yMTQgNDk1LjY3NSA2MTguNzE2IDQ4MS44MjEgNjE1Ljk1OCA0NzcuMzQ2TDYxNC42MDkgNDc1LjA3OEw2MTkuMjY4IDQ2OC4xNTFDNjMzLjU1MSA0NDYuNjk1IDY0MS44ODggNDIzLjI3OCA2NDUuMTM3IDM5NS41N0M2NDYuNjA4IDM4My41NTUgNjQ2LjExOCAzNTkuMjggNjQ0LjI3OSAzNDcuMjY1QzYzOS40OTcgMzE2Ljc5OCA2MjguMjc5IDI4OC44NDUgNjEwLjg3IDI2NC4wOEM2MDEuNzk3IDI1MS4xNDUgNTg4LjYxNyAyMzYuOTg0IDU3Ny4wOTMgMjI3Ljc4OUM1NzMuNzIxIDIyNS4wOTIgNTcwLjcxNyAyMjIuNjQgNTcwLjQ3MiAyMjIuMzk1QzU3MC4xNjYgMjIyLjE1IDU3MC41MzQgMjE4Ljc3OCA1NzEuMjY5IDIxNC45NzdDNTc4LjY4NyAxNzYuMjk2IDU3OC40NDEgMTI4LjA1MyA1NzAuNjU2IDkwLjM1MjRDNTYzLjkxMyA1Ny40OTUxIDU1MS42NTMgMzEuMzgwOCA1MzUuODM3IDE2LjMwMDhDNTIzLjIwOSA0LjI4NTc4IDUxMC4zMzYgLTAuODYzNTA3IDQ5NC44ODggMC4xMTczMUM0NTkuNDU2IDIuMjAxNTQgNDMwLjg5IDQyLjk2NjcgNDE5LjYxIDEwNy4yMUM0MTcuNzcxIDExNy41NyA0MTYuMTc4IDEyOS43MDggNDE2LjE3OCAxMzMuMDE4QzQxNi4xNzggMTM0LjMwNSA0MTUuOTMyIDEzNS4zNDcgNDE1LjYyNiAxMzUuMzQ3QzQxNS4zMTkgMTM1LjM0NyA0MTIuOTI5IDEzNC4xMjEgNDEwLjM1NCAxMzIuNTg5QzM4My4wMTQgMTE2LjQwNSAzNTIuNjA4IDEwNy43NjIgMzIzIDEwNy43NjJDMjkzLjM5MiAxMDcuNzYyIDI2Mi45ODYgMTE2LjQwNSAyMzUuNjQ2IDEzMi41ODlDMjMzLjA3MSAxMzQuMTIxIDIzMC42ODEgMTM1LjM0NyAyMzAuMzc0IDEzNS4zNDdDMjMwLjA2OCAxMzUuMzQ3IDIyOS44MjIgMTM0LjMwNSAyMjkuODIyIDEzMy4wMThDMjI5LjgyMiAxMjkuNTg1IDIyOC4xNjcgMTE3LjA4IDIyNi4zOSAxMDcuMjFDMjE2LjE1MiA0OS41MjU5IDE5Mi42NzQgMTEuMzM1NCAxNjEuNDcyIDEuNzExMTJDMTU3LjE4MSAwLjQyMzc5OSAxNDQuOTgyIC0wLjQzNDM4MiAxNDAuNjI5IDAuMjM5OTI5Wk0xNTEuMDUxIDUwLjEzOUMxNTkuODc4IDU3LjEyNzMgMTY5LjY4NiA3Ny4xMTE0IDE3NS4zMjYgOTkuNDg2M0MxNzYuMzY4IDEwMy41MzIgMTc3LjQ3MSAxMDguMTkxIDE3Ny43NzggMTA5LjkwN0MxNzguMDIzIDExMS41NjMgMTc4LjY5NyAxMTUuMzAyIDE3OS4yNDkgMTE4LjE4M0MxODEuNjQgMTMxLjE3OSAxODIuNzQzIDE0NS4yMTcgMTgyLjg2NiAxNjIuMzJMMTgyLjkyNyAxNzkuMTc4TDE3OC42OTcgMTg1LjQzTDE3NC40NjggMTkxLjc0NEgxNjQuNTk4QzE1My4wNzQgMTkxLjc0NCAxNDEuNjEgMTkzLjIxNiAxMzAuNjM3IDE5Ni4xNThDMTI2LjcxNCAxOTcuMTM5IDEyMi45MTMgMTk4LjEyIDEyMi4xNzggMTk4LjMwNEMxMjEuMDEzIDE5OC41NDkgMTIwLjgyOSAxOTguMTgxIDEyMC4xNTUgMTkzLjE1NEMxMTYuNTM4IDE2NS44NzUgMTE2LjcyMiAxMzUuNjU0IDEyMC43MDcgMTEwLjUyQzEyNS4xMiA4Mi41MDU5IDEzNS40MTkgNTcuMTI3MyAxNDUuNDcyIDQ5LjY0ODZDMTQ3Ljg2MyA0Ny44NzA4IDE0OC4yOTIgNDcuOTMyMSAxNTEuMDUxIDUwLjEzOVpNNTAwLjU4OSA0OS43MDk4QzUwNi42NTggNTQuMTg0OCA1MTMuMzQgNjYuMDc3MiA1MTguMzA1IDgxLjI3OThDNTI4LjI5NyAxMTEuNjg1IDUzMS4xMTcgMTUzLjQzMSA1MjUuODQ1IDE5My4xNTRDNTI1LjE3MSAxOTguMTgxIDUyNC45ODcgMTk4LjU0OSA1MjMuODIyIDE5OC4zMDRDNTIzLjA4NyAxOTguMTIgNTE5LjI4NiAxOTcuMTM5IDUxNS4zNjMgMTk2LjE1OEM1MDQuMzkgMTkzLjIxNiA0OTIuOTI2IDE5MS43NDQgNDgxLjQwMiAxOTEuNzQ0SDQ3MS41MzJMNDY3LjMwMyAxODUuNDNMNDYzLjA3MyAxNzkuMTc4TDQ2My4xMzQgMTYyLjMyQzQ2My4yNTcgMTM4LjUzNSA0NjUuNDY0IDExOS45NjEgNDcwLjczNSA5OS4zMDI0QzQ3Ni4zMTQgNzcuMTExNCA0ODYuMTgzIDU3LjEyNzMgNDk0Ljk0OSA1MC4xMzlDNDk3LjcwOCA0Ny45MzIxIDQ5OC4xMzcgNDcuODcwOCA1MDAuNTg5IDQ5LjcwOThaIiBmaWxsPSJibGFjayIvPgo8cGF0aCBkPSJNMzEzLjQ5OCAzNTguMjM3QzMwMC4xOTUgMzU5LjUyNSAyOTYuNTc5IDM2MC4wMTUgMjkwLjIwMyAzNjEuMzAzQzI3OS44NDMgMzYzLjQ0OCAyNjUuOTg5IDM2OC4yMyAyNTYuMzY1IDM3Mi45NUMyMjIuODk1IDM4OS4zMTcgMTk5Ljg0NiA0MTYuNTk2IDE5Mi43OTYgNDQ4LjE2NkMxOTEuMzg2IDQ1NC40MTkgMTkxLjIwMiA0NTYuNTAzIDE5MS4yMDIgNDY3LjA0N0MxOTEuMjAyIDQ3Ny40NjggMTkxLjM4NiA0NzkuNzM2IDE5Mi43MzUgNDg1LjY4MkMyMDIuMTE0IDUyNi45MzggMjQwLjEyIDU1Ny40MDUgMjg5LjI4NCA1NjIuOTgzQzI5OS45NSA1NjQuMTQ4IDM0Ni4wNDkgNTY0LjE0OCAzNTYuNzE1IDU2Mi45ODNDMzk2LjE5MyA1NTguNTA4IDQzMC4xNTQgNTM3LjExNCA0NDUuNDE4IDUwNy4wNzZDNDQ5LjQ2MyA0OTkuMDQ2IDQ1MS40MjUgNDkzLjgzNSA0NTMuMjY0IDQ4NS42ODJDNDU0LjYxMyA0NzkuNzM2IDQ1NC43OTcgNDc3LjQ2OCA0NTQuNzk3IDQ2Ny4wNDdDNDU0Ljc5NyA0NTYuNTAzIDQ1NC42MTMgNDU0LjQxOSA0NTMuMjAzIDQ0OC4xNjZDNDQyLjk2NSA0MDIuMzEzIDM5OC40NjEgMzY2LjIwNyAzNDMuOTAzIDM1OS4zNDFDMzM2Ljc5MiAzNTguNDgzIDMxOC4xNTcgMzU3Ljc0NyAzMTMuNDk4IDM1OC4yMzdaTTMzNi40MjQgMzkxLjU4NUMzNTQuNjMxIDM5My41NDcgMzcyLjk2IDQwMC4wNDUgMzg3LjY3MiA0MDkuODUzQzM5NS41OCA0MTUuMTI1IDQwNi43MzcgNDI2LjE1OSA0MTEuNTE4IDQzMy4zOTNDNDE3LjQwMyA0NDIuMzQyIDQyMC43NzQgNDUxLjQ3NiA0MjIuMzA3IDQ2Mi41NzJDNDIyLjk4MSA0NjcuNjYgNDIyLjYxNCA0NzEuNTIyIDQyMC43NzQgNDc5LjczNkM0MTcuODkzIDQ5MS45OTYgNDA4Ljk0MyA1MDQuODA4IDM5Ni44NjcgNTEzLjc1OEMzOTEuMjI3IDUxNy44NjUgMzc5LjUxOSA1MjMuODEyIDM3Mi4zNDcgNTI2LjE0MUMzNTguNzM4IDUzMC40OTMgMzQ5Ljg0OSA1MzEuMjkgMzE4LjA5NSA1MzEuMDQ1QzI5Ny4zNzYgNTMwLjg2MSAyOTMuNjk3IDUzMC42NzcgMjg3Ljc1MSA1MjkuNTc0QzI2Ny40NjEgNTI1Ljc3MyAyNTEuNCA1MTcuNjgxIDIzOS43NTMgNTA1LjM2QzIzMC4zMTIgNDk1LjQyOSAyMjYuMDIxIDQ4Ni4zNTcgMjIzLjY5MiA0NzEuNzA2QzIyMi42NSA0NjQuOTAxIDIyNC42MTEgNDUzLjYyMiAyMjguNTk2IDQ0NC4xMkMyMzMuNDM5IDQzMi41MzQgMjQ1Ljk0NCA0MTguMTI5IDI1OC4zMjcgNDA5Ljg1M0MyNzIuNjcxIDQwMC4yOSAyOTEuNTUyIDM5My40ODYgMzA4LjkgMzkxLjY0N0MzMTUuNTgyIDM5MC45MTEgMzI5Ljc0MiAzOTAuOTExIDMzNi40MjQgMzkxLjU4NVoiIGZpbGw9ImJsYWNrIi8+CjxwYXRoIGQ9Ik0yOTkuNTg0IDQzNi4zMzZDMjk0LjkyNSA0MzguODQ5IDI5MS42NzYgNDQ1LjIyNCAyOTIuNjU3IDQ0OS45NDRDMjkzLjc2IDQ1NS4wMzIgMjk4LjIzNSA0NjAuMTgyIDMwNS4yMjMgNDY0LjQxMkMzMDguOTYzIDQ2Ni42OCAzMDkuMjA4IDQ2Ni45ODYgMzA5LjM5MiA0NjkuMjU0QzMwOS41MTQgNDcwLjYwMyAzMDkuMDI0IDQ3NC40NjUgMzA4LjM1IDQ3Ny44OThDMzA3LjYxNCA0ODEuMjY5IDMwNy4wNjIgNDg0LjgyNSAzMDcuMDYyIDQ4NS44MDZDMzA3LjEyNCA0ODguNDQyIDMwOS41NzYgNDkyLjczMyAzMTIuMTUgNDk0LjgxN0MzMTQuNDE5IDQ5Ni42NTYgMzE0Ljg0OCA0OTYuNzE3IDMyMS4yMjMgNDk2LjkwMUMzMjcuMDQ3IDQ5Ny4wODUgMzI4LjI3MyA0OTYuOTYyIDMzMC42MDIgNDk1Ljg1OUMzMzYuNjEgNDkyLjkxNiAzMzguMTQyIDQ4Ny41MjIgMzM1LjkzNSA0NzcuMTYyQzMzNC4wOTYgNDY4LjUxOSAzMzQuNDY0IDQ2Ny4xNyAzMzkuMDYyIDQ2NC41MzRDMzQzLjkwNCA0NjEuNzE0IDM0OS4wNTQgNDU2Ljc0OSAzNTAuNTg2IDQ1My4zNzdDMzUzLjUyOSA0NDYuOTQxIDM1MC44MzEgNDM5LjY0NiAzNDQuMzMzIDQzNi4yNzRDMzQyLjc0IDQzNS40NzcgMzQwLjc3OCA0MzUuMTEgMzM3Ljg5NyA0MzUuMTFDMzMzLjQyMiA0MzUuMTEgMzMwLjU0MSA0MzYuMTUyIDMyNS4yNjkgNDM5LjUyM0wzMjIuMjY1IDQ0MS40MjRMMzIwLjM2NSA0NDAuMjU5QzMxMi41OCA0MzUuNjYxIDMxMS4xNyA0MzUuMTEgMzA2LjQ0OSA0MzUuMTcxQzMwMy4wNzggNDM1LjE3MSAzMDEuMjM5IDQzNS40NzcgMjk5LjU4NCA0MzYuMzM2WiIgZmlsbD0iYmxhY2siLz4KPHBhdGggZD0iTTE1MC43NDQgMzY1LjE2NUMxMzkuODk0IDM2OC41OTggMTMxLjgwMiAzNzYuNTY3IDEyNy42MzQgMzg3LjkwOEMxMjUuNjExIDM5My4zMDMgMTI0LjYzIDQwMS44MjQgMTI1LjQ4OCA0MDYuNDIxQzEyNy41MTEgNDE3LjM5NCAxMzYuNTIyIDQyNy4zODYgMTQ2Ljc2IDQzMC4xNDVDMTU5LjYzMyA0MzMuNTE2IDE2OS4yNTcgNDMxLjMwOSAxNzcuNzc4IDQyMi44NUMxODIuNzQzIDQxOC4wMDcgMTg1LjQ0MSA0MTMuNzc3IDE4OC4xMzggNDA2LjkxMUMxOTAuMDk5IDQwMi4wNjkgMTkwLjIyMiA0MDEuMjExIDE5MC4yMjIgMzk0LjM0NUwxOTAuMjgzIDM4Ni45ODlMMTg3LjcwOSAzODEuNzE3QzE4My42MDEgMzczLjM4IDE3Ni4xODQgMzY3LjE4OCAxNjcuNjAyIDM2NC45MkMxNjIuNzU5IDM2My42OTQgMTU0Ljk3NCAzNjMuNzU2IDE1MC43NDQgMzY1LjE2NVoiIGZpbGw9ImJsYWNrIi8+CjxwYXRoIGQ9Ik00NzguMTUzIDM2NC45ODJDNDY5Ljc1NSAzNjcuMjUgNDYyLjI3NiAzNzMuNTAyIDQ1OC4yOTEgMzgxLjcxN0w0NTUuNzE3IDM4Ni45ODlMNDU1Ljc3OCAzOTQuMzQ1QzQ1NS43NzggNDAxLjIxMSA0NTUuOTAxIDQwMi4wNjkgNDU3Ljg2MiA0MDYuOTExQzQ2MC41NiA0MTMuNzc3IDQ2My4yNTcgNDE4LjAwNyA0NjguMjIyIDQyMi44NUM0NzYuNzQzIDQzMS4zMDkgNDg2LjM2NyA0MzMuNTE2IDQ5OS4yNDEgNDMwLjE0NUM1MDYuNjU4IDQyOC4xODMgNTE0LjA3NSA0MjEuOTMgNTE3LjYzMSA0MTQuNjM1QzUyMC42OTYgNDA4LjQ0NCA1MjEuNDMxIDQwMy45NjkgNTIwLjQ1MSAzOTYuOTE5QzUxOC4xODMgMzgwLjc5NyA1MDguNzQyIDM2OS4wODkgNDk0LjcwNCAzNjQuOTgyQzQ5MC41OTcgMzYzLjc1NiA0ODIuNjI4IDM2My43NTYgNDc4LjE1MyAzNjQuOTgyWiIgZmlsbD0iYmxhY2siLz4KPC9zdmc+Cg=="
  OPENAI_IMG: "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IS0tIFVwbG9hZGVkIHRvOiBTVkcgUmVwbywgd3d3LnN2Z3JlcG8uY29tLCBHZW5lcmF0b3I6IFNWRyBSZXBvIE1peGVyIFRvb2xzIC0tPgo8c3ZnIGZpbGw9IiMwMDAwMDAiIHdpZHRoPSI4MDBweCIgaGVpZ2h0PSI4MDBweCIgdmlld0JveD0iMCAwIDI0IDI0IiByb2xlPSJpbWciIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHRpdGxlPk9wZW5BSSBpY29uPC90aXRsZT48cGF0aCBkPSJNMjIuMjgxOSA5LjgyMTFhNS45ODQ3IDUuOTg0NyAwIDAgMC0uNTE1Ny00LjkxMDggNi4wNDYyIDYuMDQ2MiAwIDAgMC02LjUwOTgtMi45QTYuMDY1MSA2LjA2NTEgMCAwIDAgNC45ODA3IDQuMTgxOGE1Ljk4NDcgNS45ODQ3IDAgMCAwLTMuOTk3NyAyLjkgNi4wNDYyIDYuMDQ2MiAwIDAgMCAuNzQyNyA3LjA5NjYgNS45OCA1Ljk4IDAgMCAwIC41MTEgNC45MTA3IDYuMDUxIDYuMDUxIDAgMCAwIDYuNTE0NiAyLjkwMDFBNS45ODQ3IDUuOTg0NyAwIDAgMCAxMy4yNTk5IDI0YTYuMDU1NyA2LjA1NTcgMCAwIDAgNS43NzE4LTQuMjA1OCA1Ljk4OTQgNS45ODk0IDAgMCAwIDMuOTk3Ny0yLjkwMDEgNi4wNTU3IDYuMDU1NyAwIDAgMC0uNzQ3NS03LjA3Mjl6bS05LjAyMiAxMi42MDgxYTQuNDc1NSA0LjQ3NTUgMCAwIDEtMi44NzY0LTEuMDQwOGwuMTQxOS0uMDgwNCA0Ljc3ODMtMi43NTgyYS43OTQ4Ljc5NDggMCAwIDAgLjM5MjctLjY4MTN2LTYuNzM2OWwyLjAyIDEuMTY4NmEuMDcxLjA3MSAwIDAgMSAuMDM4LjA1MnY1LjU4MjZhNC41MDQgNC41MDQgMCAwIDEtNC40OTQ1IDQuNDk0NHptLTkuNjYwNy00LjEyNTRhNC40NzA4IDQuNDcwOCAwIDAgMS0uNTM0Ni0zLjAxMzdsLjE0Mi4wODUyIDQuNzgzIDIuNzU4MmEuNzcxMi43NzEyIDAgMCAwIC43ODA2IDBsNS44NDI4LTMuMzY4NXYyLjMzMjRhLjA4MDQuMDgwNCAwIDAgMS0uMDMzMi4wNjE1TDkuNzQgMTkuOTUwMmE0LjQ5OTIgNC40OTkyIDAgMCAxLTYuMTQwOC0xLjY0NjR6TTIuMzQwOCA3Ljg5NTZhNC40ODUgNC40ODUgMCAwIDEgMi4zNjU1LTEuOTcyOFYxMS42YS43NjY0Ljc2NjQgMCAwIDAgLjM4NzkuNjc2NWw1LjgxNDQgMy4zNTQzLTIuMDIwMSAxLjE2ODVhLjA3NTcuMDc1NyAwIDAgMS0uMDcxIDBsLTQuODMwMy0yLjc4NjVBNC41MDQgNC41MDQgMCAwIDEgMi4zNDA4IDcuODcyem0xNi41OTYzIDMuODU1OEwxMy4xMDM4IDguMzY0IDE1LjExOTIgNy4yYS4wNzU3LjA3NTcgMCAwIDEgLjA3MSAwbDQuODMwMyAyLjc5MTNhNC40OTQ0IDQuNDk0NCAwIDAgMS0uNjc2NSA4LjEwNDJ2LTUuNjc3MmEuNzkuNzkgMCAwIDAtLjQwNy0uNjY3em0yLjAxMDctMy4wMjMxbC0uMTQyLS4wODUyLTQuNzczNS0yLjc4MThhLjc3NTkuNzc1OSAwIDAgMC0uNzg1NCAwTDkuNDA5IDkuMjI5N1Y2Ljg5NzRhLjA2NjIuMDY2MiAwIDAgMSAuMDI4NC0uMDYxNWw0LjgzMDMtMi43ODY2YTQuNDk5MiA0LjQ5OTIgMCAwIDEgNi42ODAyIDQuNjZ6TTguMzA2NSAxMi44NjNsLTIuMDItMS4xNjM4YS4wODA0LjA4MDQgMCAwIDEtLjAzOC0uMDU2N1Y2LjA3NDJhNC40OTkyIDQuNDk5MiAwIDAgMSA3LjM3NTctMy40NTM3bC0uMTQyLjA4MDVMOC43MDQgNS40NTlhLjc5NDguNzk0OCAwIDAgMC0uMzkyNy42ODEzem0xLjA5NzYtMi4zNjU0bDIuNjAyLTEuNDk5OCAyLjYwNjkgMS40OTk4djIuOTk5NGwtMi41OTc0IDEuNDk5Ny0yLjYwNjctMS40OTk3WiIvPjwvc3ZnPg=="
  MILVUS_IMG: "data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzNjAgMzYwIj48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6IzMzYjVmMTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPm1pbHZ1cy1pY29uLWNvbG9yPC90aXRsZT48cGF0aCBjbGFzcz0iY2xzLTEiIGQ9Ik0xNjguNTA5ODMsNjMuMzI5M2MzMS45NTY3MS41MDcsNTkuOTM1NTksMTEuMTEyODYsODMuMjc2ODYsMzMuMTg1MzUsMTguNzAwNiwxNy42ODQwNywzMC4yMjY2NywzOS4zMjUxMiwzNC44MTMyOCw2NC42NDQ1MkExMDUuMzIxMTUsMTA1LjMyMTE1LDAsMCwxLDI4OC4zMDk0OCwxODIuMDVjLS41Njk2NywyOC40NzAzOS05Ljk0MTUzLDUzLjY2NjY3LTI4LjY1MzQzLDc1LjE5NzEzLTE4LjEzNjY3LDIwLjg2ODcyLTQwLjkwODg4LDM0LjExNDkzLTY4LjA1NDY5LDM5LjEwMjIyLTM2LjYxMDY2LDYuNzI2My02OS44MjYxNC0xLjQ0NjEzLTk5LjIyNjU2LTI0LjQ3MzM3LTYuMTA3MzUtNC43ODM0MS0xMS40MDY2Ny0xMC40NDkyNy0xNi45MjkxOC0xNS44NjU2OHEtMTcuODMzNTktMTcuNDkwNjktMzUuNjI1LTM1LjAyNDZRMjMuNjgxNTIsMjA1LjEyNTU3LDcuNTM1MzUsMTg5LjI3Mjg3Yy00Ljk5ODExLTQuOTI2NDMtNS4wMDE2Ni0xMS43NjE3Ny0uMDA2MTgtMTYuNjg3NzVxMTYuNTgyMzktMTYuMzUxOTMsMzMuMjIyLTMyLjY0NTc5YzEwLjQxNS0xMC4yMjUxMywyMC43NzgyLTIwLjUwNDE3LDMxLjI3MzgxLTMwLjY0NjA2LDYuOTY4LTYuNzMzMDgsMTMuNTYyMS0xMy44NjY3LDIxLjIwNTE1LTE5Ljg4ODc4YTExOS42ODk3NiwxMTkuNjg5NzYsMCwwLDEsNTEuMzQ1MTctMjMuNjg2NjcsMTIxLjE2MiwxMjEuMTYyLDAsMCwxLDIzLjkzNDU5LTIuMzg4NjlabTkyLjM3MSwxMTcuNjkwODVhOTEuOTk4MjIsOTEuOTk4MjIsMCwwLDAtMS40ODkwNi0xNS4wOTA3MWMtNC42NTg5LTI0LjQyMTMyLTE3LjQ4OTQ0LTQzLjQ5NTQ0LTM4LjIzOTM4LTU2Ljk4NjY0LTIwLjAxMjgzLTEzLjAxMTg4LTQyLjAwNzkyLTE3LjA1NTY4LTY1LjQ2NjI4LTEyLjYxNDI4YTg1LjYxOTUyLDg1LjYxOTUyLDAsMCwwLTQ0LjAxODYyLDIyLjY0NjhjLTguMjE1ODIsNy44NDcyNi0xNi4yNjksMTUuODY1MDUtMjQuMzgxNjMsMjMuODIwMTNxLTE2LjMxMzMyLDE1Ljk5NjY2LTMyLjU5ODM3LDMyLjAyMTljLTMuNzUsMy42OTc0OS0zLjczMzk0LDguNTI5MDgtLjAxMjY2LDEyLjIwOTg5LDUuMzI3NTgsNS4yNjk1LDEwLjY5Mjg1LDEwLjUwMDg1LDE2LjAzNjM1LDE1Ljc1NDI5cTE5LjU0MTM4LDE5LjIxMTg5LDM5LjA4MjQ2LDM4LjQyNCwyOC4zMzQzMSwyNy43NTMzNiw2Ny45OCwyNS45NDAzNWE4My4wMzI3OSw4My4wMzI3OSwwLDAsMCwzOS4xNzQyMS0xMS41MjcyOWMyOC4yMzcyOS0xNi44MTUxOSw0Mi42NjAzOS00MS44Nzk1Nyw0My45MzMwNS03NC41OTg0MVptNTguMjM2MTItLjA3NTIyYTE3MS4zNzU2NiwxNzEuMzc1NjYsMCwwLDAtNC4wOTA3NS0zOC4xMTQyNSwxMS43MzcyMywxMS43MzcyMywwLDAsMS0uMjAxMTEtMS4xNTY1LDIuNjM0NzgsMi42MzQ3OCwwLDAsMSwxLjI3NDgxLTIuNzQ3NTIsMi42NzA5MiwyLjY3MDkyLDAsMCwxLDMuMTYxOTQuMDIxNDcsOS4xMzcxMSw5LjEzNzExLDAsMCwxLDEuMTg4NjQsMS4wODU2cTE2LjE1NTEyLDE2LjE0ODM0LDMyLjMwNSwzMi4zMDIyNmM1LjMwNjU4LDUuMzA3NSw1LjI5NjcsMTIuMDY1MTUtLjAyMjU1LDE3LjM4NDU1cS0xNi4wOTk1NywxNi4xMDAxNi0zMi4xOTk3LDMyLjE5OTg1Yy0uMjc3LjI3Njk1LS41NDY4Mi41NjE3OS0uODM0NDUuODI3MTdhMi43MzA4NSwyLjczMDg1LDAsMCwxLTMuNTAxOTIuNDQwMjMsMi42ODM0LDIuNjgzNCwwLDAsMS0xLjM1MS0zLjExNTc3YzEuMTMxOTItNS4yMDU4NywyLjEwMjMyLTEwLjQzOTY5LDIuNzk4LTE1LjcyNTczYTE2NC4yMjM4OCwxNjQuMjIzODgsMCwwLDAsMS40Njk0NC0xOC44NTU4NmMuMDIzOC0xLjUxNDcuMDAzNTUtMy4wMzAzNC4wMDM1NS00LjU0NTUxWiIvPjxwYXRoIGNsYXNzPSJjbHMtMSIgZD0iTTIzMi4yMDYyNSwxODAuOTY1YTcwLjQ4OTMxLDcwLjQ4OTMxLDAsMSwwLS4wMDAxNSwwWiIvPjwvc3ZnPg=="

  GENAI_SYSTEMS_QUERY_VIEW: "240620401795738"
  GENAI_SYSTEMS_VIEW_TYPE: "261619359355051"

  GPU_NODES_QUERY_VIEW: "167154587776474"
  GPU_NODES_VIEW_TYPE: "23189880660604"

  GENAI_COMPONENTS_QUERY_VIEW: "113310065437894"

  GENAI_MODEL_QUERY_VIEW: "212001111760979"

  VECTOR_DB_QUERY_VIEW: "32546870507121"

  MAIN_MENU_GROUP_ID: "221281420993782"

tasks:

  upload-menu:
    silent: false
    cmds:
#      - http POST {{.STS_URL}}/api/node/sync/{{.MAIN_MENU_GROUP_ID}}/unlock X-API-Token:{{.STS_TOKEN}}
#      - http POST {{.STS_URL}}/api/node/sync/{{.GENAI_SYSTEMS_QUERY_VIEW}}/unlock X-API-Token:{{.STS_TOKEN}}
#      - http POST {{.STS_URL}}/api/node/sync/{{.GENAI_MODEL_QUERY_VIEW}}/unlock X-API-Token:{{.STS_TOKEN}}
#      - http POST {{.STS_URL}}/api/node/sync/{{.VECTOR_DB_QUERY_VIEW}}/unlock X-API-Token:{{.STS_TOKEN}}
#      - http POST {{.STS_URL}}/api/node/sync/{{.GENAI_COMPONENTS_QUERY_VIEW}}/unlock X-API-Token:{{.STS_TOKEN}}
#      - http POST {{.STS_URL}}/api/node/sync/{{.GPU_NODES_QUERY_VIEW}}/unlock X-API-Token:{{.STS_TOKEN}}
      - sts settings apply -f ./menu/llm.yaml --context {{.STS_CONTEXT}}
  upload-overviews:
    silent: true
    cmds:
#      - http POST {{.STS_URL}}/api/node/sync/{{.GENAI_SYSTEMS_VIEW_TYPE}}/unlock X-API-Token:{{.STS_TOKEN}}
#      - http POST {{.STS_URL}}/api/node/sync/{{.GPU_NODES_VIEW_TYPE}}/unlock X-API-Token:{{.STS_TOKEN}}
      - sts settings apply -f ./overview/genai_system.yaml --context {{.STS_CONTEXT}}
      - sts settings apply -f ./overview/gpu_nodes.yaml --context {{.STS_CONTEXT}}
      - sts settings apply -f ./overview/vector_db_system.yaml --context {{.STS_CONTEXT}}
      - sts settings apply -f ./overview/genai_apps.yaml --context {{.STS_CONTEXT}}

  upload-highlights:
    silent: true
    deps: [generate-component-files]
    cmds:
      - sts settings apply -f ./components/genai_system_ollama.yaml --context {{.STS_CONTEXT}}
      - sts settings apply -f ./components/genai_system_openai.yaml --context {{.STS_CONTEXT}}
      - sts settings apply -f ./components/genai_dbsystem_milvus.yaml --context {{.STS_CONTEXT}}

  upload-metric-bindings:
    silent: true
    deps: 
      - generate-metric-bindings
      - generate-gpu-metric-binding
    cmds:
      - echo "Uploading metric bindings"
      - sts settings apply -f ./metrics/gpu_nodes.yaml --context {{.STS_CONTEXT}}
      - sts settings apply -f ./metrics/genai_systems.yaml --context {{.STS_CONTEXT}}
      - sts settings apply -f ./metrics/db_systems.yaml --context {{.STS_CONTEXT}}
      - sts settings apply -f ./metrics/genai_apps.yaml --context {{.STS_CONTEXT}}

  upload-monitors:
    silent: true
    cmds:
      - sts monitor apply -f ./monitors/monitors.yaml --context {{.STS_CONTEXT}}

  #  Utility Tasks
  download-component-types:
    cmds:
      - task: download-api-data
        vars:
          URI: node/ComponentType?fullNode=true
          OUTPUT: component_types.yaml

  download-api-data:
      internal: true
      cmds:
        - |
          curl -s -o temp.json --location --request GET '{{.STS_URL}}/api/{{.URI}}' --header 'X-API-Token: {{.STS_TOKEN}}' --header 'Content-Type: application/json'
          yq -P -o=yaml . temp.json > {{.OUTPUT}} && rm temp.json

  generate-component-files:
    silent: true
    internal: true
    cmds:
      - echo "Generate genai_system_ollama component file"
      - task: render
        vars:
            CTX: '{"Type": "genai.system.ollama", "IconBase64": "{{.OLLAMA_IMG}}"}'
            TEMPLATE: ./components/tpl/genai_system.tmpl.yaml
            OUTPUT: ./components/genai_system_ollama.yaml
      - echo "Generate genai_system_openai component file"
      - task: render
        vars:
          CTX: '{"Type": "genai.system.openai", "IconBase64": "{{.OPENAI_IMG}}"}'
          TEMPLATE: ./components/tpl/genai_system.tmpl.yaml
          OUTPUT: ./components/genai_system_openai.yaml

      - echo "Generate genai.dbsystem.milvus component file"
      - task: render
        vars:
          CTX: '{"Type": "genai.dbsystem.milvus", "IconBase64": "{{.MILVUS_IMG}}"}'
          TEMPLATE: ./components/tpl/db_system.tmpl.yaml
          OUTPUT: ./components/genai_dbsystem_milvus.yaml
   
  generate-gpu-metric-binding:
    silent: true
    internal: true
    cmds:
      - echo "Generate gpu node bindings"
      - task: render
        vars:
          CTX: |-
            {
            "Prefix": "node",
            "Filter": "k8s_node_name=\"${name}\"",
            "Scope": "(label IN (\"nvidia.com/gpu.present:true\") AND type IN (\"node\"))"
            }
          TEMPLATE: ./metrics/tpl/gpu.tmpl.yaml
          OUTPUT: ./metrics/gpu_nodes.yaml
      - echo "Generate gpu pod bindings"
      - task: render
        vars:
          CTX: |-
            {
            "Prefix": "pod",
            "Filter": "k8s_node_name=\"${tags.node-name}\", pod_name=\"${name}\"",
            "Scope": "type IN (\"pod\"))"
            }
          TEMPLATE: ./metrics/tpl/gpu.tmpl.yaml
          OUTPUT: ./metrics/gpu_pods.yaml
          
  generate-metric-bindings:
    silent: true
    internal: true
    cmds:

      - echo "Generate genai system bindings"
      - task: render
        vars:
          CTX: |-
            {
            "Prefix": "genai-system",
            "Filter": "gen_ai_system=\"${name}\"",
            "Scope": "type in (\"genai.system.ollama\", \"genai.system.openai\")"
            }
          TEMPLATE: ./metrics/tpl/genai_dashboard.tmpl.yaml
          OUTPUT: ./metrics/genai_systems.yaml

      - echo "Generate vector db system bindings"
      - task: render
        vars:
          CTX: |-
            {
            "Prefix": "vectordb-system",
            "Filter": "db_system=\"${name}\"",
            "Scope": "type in (\"genai.dbsystem.milvus\")"
            }
          TEMPLATE: ./metrics/tpl/db_dashboard.tmpl.yaml
          OUTPUT: ./metrics/db_systems.yaml

      - echo "Generate genai app bindings"
      - task: render
        vars:
          CTX: |-
            {
            "Prefix": "genai-app",
            "Filter": "service_name=\"${name}\"",
            "Scope": "type in (\"otel service\", \"genai.app\") AND label in (\"gen_ai_app\")"
            }
          TEMPLATE: ./metrics/tpl/genai_dashboard.tmpl.yaml
          OUTPUT: ./metrics/genai_apps.yaml


  render:
    silent: true
    internal: true
    cmds:
      - |
          echo '{{.CTX}}' | gomplate -c .=stdin:///in.json -f {{.TEMPLATE}} -o {{.OUTPUT}}